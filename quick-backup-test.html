<!DOCTYPE html>
<html>
<head>
    <title>Quick Backup Test</title>
</head>
<body>
    <h1>Quick Backup Test</h1>
    <button id="testBackup">Test Backup System</button>
    <div id="results"></div>

    <script type="module">
        import { supabase } from './src/lib/supabase.js';

        const testTables = [
            'users',
            'cms_pages', 
            'organizations',
            'events',
            'categories',
            'admin_settings'
        ];

        document.getElementById('testBackup').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing table access...</p>';

            const results = [];
            
            for (const table of testTables) {
                try {
                    const { data, error } = await supabase.from(table).select('*').limit(1);
                    
                    if (error) {
                        results.push(`❌ ${table}: ${error.message}`);
                    } else {
                        results.push(`✅ ${table}: Accessible (${data?.length || 0} rows in sample)`);
                    }
                } catch (err) {
                    results.push(`❌ ${table}: ${err.message}`);
                }
            }

            resultsDiv.innerHTML = `
                <h2>Results:</h2>
                <pre>${results.join('\n')}</pre>
                <h3>Now testing backup function...</h3>
            `;

            // Test the actual backup function
            try {
                const { createDatabaseBackup } = await import('./src/utils/backup.js');
                const result = await createDatabaseBackup('manual');
                
                resultsDiv.innerHTML += `
                    <h3>Backup Test Result:</h3>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (err) {
                resultsDiv.innerHTML += `
                    <h3>Backup Test Error:</h3>
                    <pre>${err.message}</pre>
                `;
            }
        });
    </script>
</body>
</html>